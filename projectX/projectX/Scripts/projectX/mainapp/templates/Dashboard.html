<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard with Enhanced Styling</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet" />

    <!-- Bootstrap JS (with Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    {%load static%}

    <link rel="stylesheet" href="{% static 'css/style.css' %}">


</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container-fluid px-4">
            <a class="navbar-brand ms-3 fw-bold" href="#">Dashboard</a>
            <div class="d-flex ms-auto">
                <!-- Search input in desktop, search icon in mobile -->
                <form class="d-flex me-3 d-none d-lg-block">
                    <input type="search" class="form-control" placeholder="Search...">
                </form>
                <button class="btn btn-light me-3 d-lg-none">
                    <i class="fas fa-search"></i>
                </button>
                <div class="btn-group">
                    <button class="btn btn-light dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="ri-apps-2-line text-black"></i><!-- Nine dots icon -->
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <li><a class="dropdown-item" href="{% url 'email' %}"><i class="fas fa-envelope text-black"></i>
                                Email</a></li>
                        <li><a class="dropdown-item" href="{% url 'chatroom' %}"><i
                                    class="fa-regular fa-comment text-black"></i> Chatroom</a></li>
                    </ul>
                </div>
                <button class="btn btn-light">
                    <a href=""><i class="fas fa-bell text-black"></i></a>
                </button>
                <button class="btn btn-light">
                    <a href=""><i class="fa-solid fa-gear text-black"></i></a>
                </button>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar d-flex flex-column">
        <div class="toggle-button" id="toggleSidebar">
            <i class="fas fa-chevron-left"></i>
        </div>
        <ul class="nav flex-column mt-3">
            <li class="nav-item">
                <a href="{%url 'dashboard'%}" class="nav-link">
                    <i class="fas fa-home"></i><span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{%url 'research'%}" class="nav-link">
                    <i class="fas fa-search"></i><span>Research</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class="fas fa-folder"></i><span>Digital Assets</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'course' %}" class="nav-link">
                    <i class="fas fa-graduation-cap"></i><span>Training & Development</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#socialMenu">
                    <i class="fas fa-users"></i><span>Social</span>
                </a>
                <ul class="collapse list-unstyled ms-4" id="socialMenu">
                    <li><a href="{%url 'timeline'%}" class="nav-link">Timeline</a></li>
                    <li><a href="#" class="nav-link">Account</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="{% url 'work' %}" class="nav-link">
                    <i class="fa-solid fa-briefcase"></i><span>Work Listing</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="{% url 'accounts' %}" class="nav-link">
                    <i class="fa-solid fa-money-bill"></i><span>Accounts</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'profileview' %}" class="nav-link">
                    <i class="fa-solid fa-money-bill"></i><span>Profile</span>
                </a>
            </li>

        </ul>
        <div class="logout p-3 mt-auto">
            <a href="{% url 'logout'%}" class="btn btn-danger w-100 text-white">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div id="content" class="content p-4">

        <body>
            {%block content%}
            <!-- FullCalendar CSS -->
            <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
            <!-- jQuery UI for draggable and resizable -->
            <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
            <!-- Chart.js -->
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <!-- gsap -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.1/gsap.min.js"></script>

            {% load static %}

            <link rel="stylesheet" href="{% static 'css/dash.css' %}">
            <div class="container py-4">

                <!-- Header -->
                <div class="header mb-4">
                    <h1>Hi,{{user.first_name}}! your Dashboard Overview</h1>
                    <p>Manage your courses, monitor student performance, and streamline your teaching workflow all in
                        one place.</p>
                    <h4 class="text-white">Customize Your Dashboard according to your needs ! </h4>
                </div>

                <!-- Stats Row -->
                <div class="row grid g-3">
                    <div class="background-text">
                        <!-- Create an SVG text element -->
                        <svg viewBox="0 0 600 200">
                            <!-- Gradient definition -->
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color: #ff00ff; stop-opacity: 1" /> <!-- Neon Pink -->
                                    <stop offset="100%" style="stop-color: #00ffff; stop-opacity: 1" />
                                    <!-- Neon Cyan -->
                                </linearGradient>
                            </defs>
                            <text id="projectText" class="background-text" x="50%" y="50%" text-anchor="middle"
                                alignment-baseline="middle">
                                Dashboard
                            </text>
                            <text id="neonText" x="50%" y="50%" text-anchor="middle" alignment-baseline="middle">
                                Dashboard
                            </text>
                        </svg>
                    </div>
                    <div class="widget col-md-3">
                        <div class="text-center">
                            <h4>Completed Courses</h4>
                            <p class="display-6">155+</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="widget text-center">
                            <h4>Earned Certificates</h4>
                            <p class="display-6">40+</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="widget text-center">
                            <h4>Courses in Progress</h4>
                            <p class="display-6">27+</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="widget text-center">
                            <h4>Community Support</h4>
                            <p class="display-6">19k+</p>
                        </div>
                    </div>
                </div>

                <!-- Charts and Stats -->
                <div class="row g-3 mt-4">
                    <div class="col-md-4">
                        <div class="widget">
                            <h4>Total Students</h4>
                            <canvas id="studentsChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="widget">
                            <h4>Retention Rates</h4>
                            <canvas id="retentionChart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="widget">
                            <h4>Progress Statistics</h4>
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                </div>


            </div>
            <div class="container py-4">
                <!-- Calendar Widget -->
                <div class=" calendar-widget mt-4">
                    <h4>Calendar</h4>
                    <div id="calendar"></div>
                </div>
            </div>


            <!-- Bootstrap Modal for Adding Event -->
            <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="eventModalLabel">Add Event</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="eventTitle" class="form-label">Event Title</label>
                                <input type="text" class="form-control" id="eventTitle" placeholder="Enter event title">
                            </div>
                            <div class="mb-3">
                                <label for="eventDescription" class="form-label">Event Description</label>
                                <textarea class="form-control" id="eventDescription" rows="3"
                                    placeholder="Enter event description"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="eventColor" class="form-label">Event Color</label>
                                <input type="color" class="form-control form-control-color" id="eventColor"
                                    value="#f44336" title="Choose event color">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="saveEventBtn">Save Event</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="eventActionModal" tabindex="-1" aria-labelledby="eventActionModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="eventActionModalLabel">Edit/Delete Event</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="editEventTitle" class="form-label">Event Title</label>
                                <input type="text" class="form-control" id="editEventTitle"
                                    placeholder="Enter new event title">
                            </div>
                            <div class="mb-3">
                                <label for="editEventDescription" class="form-label">Event Description</label>
                                <textarea class="form-control" id="editEventDescription" rows="3"
                                    placeholder="Enter new event description"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger" id="deleteEventBtn">Delete</button>
                            <button type="button" class="btn btn-primary" id="updateEventBtn">Update</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
            <!-- jQuery -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
            <!-- jQuery UI for draggable and resizable -->
            <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
            <!-- FullCalendar JS -->
            <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
            <script>
                // Make stats and chart widgets draggable and resizable
                $('.widget').draggable({
                    containment: '.grid',
                    scroll: true
                }).resizable({
                    containment: '.grid',


                });

                // Initialize Charts
                const studentsCtx = document.getElementById('studentsChart').getContext('2d');
                const retentionCtx = document.getElementById('retentionChart').getContext('2d');
                const progressCtx = document.getElementById('progressChart').getContext('2d');

                new Chart(studentsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Retention', 'Regular', 'Dropout'],
                        datasets: [{
                            label: 'Students',
                            data: [150, 2200, 100],
                            backgroundColor: ['#4caf50', '#2196f3', '#f44336'],
                        }]
                    }
                });

                new Chart(retentionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Retained', 'Not Retained'],
                        datasets: [{
                            data: [63, 37],
                            backgroundColor: ['#4caf50', '#f44336'],
                        }]
                    }
                });

                new Chart(progressCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr'],
                        datasets: [{
                            label: 'Progress',
                            data: [60, 70, 85, 90],
                            borderColor: '#2196f3',
                            fill: false
                        }]
                    }
                });
                // Initialize Calendar with Event Adding Feature
                let selectedDate = null;  // Store the selected date for event
                let selectedEventId = null; // Store the selected event ID for editing

                document.addEventListener('DOMContentLoaded', function () {
                    var calendarEl = document.getElementById('calendar');
                    var calendar = new FullCalendar.Calendar(calendarEl, {
                        initialView: 'dayGridMonth',
                        editable: true,
                        selectable: true,
                        headerToolbar: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'dayGridMonth,dayGridWeek,dayGridDay'
                        },
                        events: [
                            { id: '1', title: 'Workshop', start: '2024-06-15', description: 'Learn JavaScript', color: '#4caf50' },
                            { id: '2', title: 'Meeting', start: '2024-06-20', description: 'Team update', color: '#2196f3' }
                        ],
                        dateClick: function (info) {
                            selectedDate = info.dateStr;
                            $('#eventModal').modal('show');
                        },
                        eventClick: function (info) {
                            // Pre-fill modal with event details
                            document.getElementById('editEventTitle').value = info.event.title;
                            document.getElementById('editEventDescription').value = info.event.extendedProps.description;
                            document.getElementById('eventColor').value = info.event.backgroundColor;
                            selectedEventId = info.event.id;

                            $('#eventActionModal').modal('show');

                            // Update event when the "Update" button is clicked
                            document.getElementById('updateEventBtn').onclick = function () {
                                var updatedTitle = document.getElementById('editEventTitle').value;
                                var updatedDescription = document.getElementById('editEventDescription').value;
                                var updatedColor = document.getElementById('eventColor').value;

                                if (updatedTitle) {
                                    // Update the event properties
                                    info.event.setProp('title', updatedTitle);
                                    info.event.setExtendedProp('description', updatedDescription);
                                    info.event.setProp('backgroundColor', updatedColor);

                                    // Optionally, refetch events to update the calendar display
                                    calendar.refetchEvents();
                                } else {
                                    alert("Event title is required!");
                                }
                            };

                            // Delete event when the "Delete" button is clicked
                            document.getElementById('deleteEventBtn').onclick = function () {
                                info.event.remove();
                                $('#eventActionModal').modal('hide');
                            };
                        },

                        // Tooltip functionality when mouse enters event
                        eventMouseEnter: function (info) {
                            var tooltip = document.createElement('div');
                            tooltip.id = 'event-tooltip';
                            tooltip.innerHTML = `<strong>${info.event.title}</strong><br>${info.event.extendedProps.description}`;
                            tooltip.style.position = 'absolute';
                            tooltip.style.background = '#fff';
                            tooltip.style.border = '1px solid #ccc';
                            tooltip.style.padding = '10px';
                            tooltip.style.zIndex = '1000';
                            tooltip.style.color = 'black';
                            tooltip.style.pointerEvents = 'none';
                            tooltip.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
                            document.body.appendChild(tooltip);

                            // Position tooltip based on mouse move
                            info.el.addEventListener('mousemove', function (e) {
                                tooltip.style.left = e.pageX + 10 + 'px';
                                tooltip.style.top = e.pageY + 10 + 'px';
                            });
                        },

                        // Remove tooltip when mouse leaves event
                        eventMouseLeave: function () {
                            var tooltip = document.getElementById('event-tooltip');
                            if (tooltip) tooltip.remove();
                        }
                    });

                    calendar.render();

                    // Save event (when creating a new event)
                    document.getElementById('saveEventBtn').addEventListener('click', function () {
                        var eventTitle = document.getElementById('eventTitle').value;
                        var eventDescription = document.getElementById('eventDescription').value;
                        var eventColor = document.getElementById('eventColor').value;

                        if (eventTitle) {
                            calendar.addEvent({
                                title: eventTitle,
                                start: selectedDate,
                                description: eventDescription,
                                backgroundColor: eventColor
                            });
                            $('#eventModal').modal('hide');
                        } else {
                            alert("Event title is required!");
                        }
                    });

                    // Reset modal state when closed
                    $('#eventModal').on('hidden.bs.modal', function () {
                        document.getElementById('eventTitle').value = '';
                        document.getElementById('eventDescription').value = '';
                        document.getElementById('eventColor').value = '#f44336';
                    });

                    // Reset event action modal when closed
                    $('#eventActionModal').on('hidden.bs.modal', function () {
                        document.getElementById('editEventTitle').value = '';
                        document.getElementById('editEventDescription').value = '';
                        document.getElementById('eventColor').value = '#f44336';
                    });
                });

                // GSAP Animation to animate the stroke-dashoffset for the neon gradient stroke effect
                gsap.to("#neonText", {
                    strokeDashoffset: 0,  // Unhide the stroke (draw it over time)
                    duration: 2,           // Duration of the animation
                    repeat: -1,            // Infinite loop
                    yoyo: true,            // Reverse the animation after each cycle
                    ease: "power1.inOut"   // Smooth ease effect
                });
            </script>
        </body>
        {%endblock%}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const toggleSidebar = document.getElementById('toggleSidebar');
        const sidebar = document.getElementById('sidebar');
        const content = document.getElementById('content');

        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
            toggleSidebar.querySelector('i').classList.toggle('fa-chevron-left');
            toggleSidebar.querySelector('i').classList.toggle('fa-chevron-right');
        });
    </script>

    <!-- Start of OpenWidget (www.openwidget.com) code -->
    <script>
        window.__ow = window.__ow || {};
        window.__ow.organizationId = "e82565b8-a7fc-46b9-b00e-57d2ca1d3f07";
        window.__ow.integration_name = "manual_settings";
        window.__ow.product_name = "openwidget";
        ; (function (n, t, c) { function i(n) { return e._h ? e._h.apply(null, n) : e._q.push(n) } var e = { _q: [], _h: null, _v: "2.0", on: function () { i(["on", c.call(arguments)]) }, once: function () { i(["once", c.call(arguments)]) }, off: function () { i(["off", c.call(arguments)]) }, get: function () { if (!e._h) throw new Error("[OpenWidget] You can't use getters before load."); return i(["get", c.call(arguments)]) }, call: function () { i(["call", c.call(arguments)]) }, init: function () { var n = t.createElement("script"); n.async = !0, n.type = "text/javascript", n.src = "https://cdn.openwidget.com/openwidget.js", t.head.appendChild(n) } }; !n.__ow.asyncInit && e.init(), n.OpenWidget = n.OpenWidget || e }(window, document, [].slice))
    </script>
    <noscript>You need to <a href="https://www.openwidget.com/enable-javascript" rel="noopener nofollow">enable
            JavaScript</a> to use the communication tool powered by <a href="https://www.openwidget.com/"
            rel="noopener nofollow" target="_blank">OpenWidget</a></noscript>
    <!-- End of OpenWidget code -->


</body>

</html>